{"id":"pfn_mcp-0tu","title":"Implement get_electricity_cost_breakdown tool","description":"Detailed breakdown analysis by shift, rate, or utility source.\n\n**Reference:** docs/electricity_cost_tools.md\n\n**Parameters:**\n- device: Device name (required)\n- period: Time period (default: 7d)\n- group_by: shift, rate, source, shift_rate (default)\n\n**Response includes:**\n- Consumption and cost per group\n- Percentage distribution\n- Supports production manager (shift) and finance (rate) views\n\n**Implementation notes:**\n- Reuse device resolution from get_electricity_cost\n- GROUP BY shift_period, rate_code, or utility_source_id\n- Calculate percentages from totals","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T08:58:53.231801+07:00","updated_at":"2025-12-27T10:20:03.337042+07:00","closed_at":"2025-12-27T10:20:03.337042+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-0tu","depends_on_id":"pfn_mcp-d71","type":"blocks","created_at":"2025-12-27T08:59:02.832553+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-0w1","title":"Remove get_electricity_cost_breakdown tool","description":"Remove redundant tool after consolidation. Update server.py call_tool handler and tools.yaml.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T10:04:27.502117+07:00","updated_at":"2026-01-10T10:33:47.032543+07:00","closed_at":"2026-01-10T10:33:47.032543+07:00","close_reason":"Completed - consolidated electricity cost tools with extended group_by options","dependencies":[{"issue_id":"pfn_mcp-0w1","depends_on_id":"pfn_mcp-t4a","type":"blocks","created_at":"2026-01-10T10:04:32.967065+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-0w1","depends_on_id":"pfn_mcp-73r","type":"blocks","created_at":"2026-01-10T10:04:33.256217+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-17x","title":"Create docs/tools-review.md documentation","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T14:06:31.781673+07:00","updated_at":"2026-01-14T14:28:14.443604+07:00","closed_at":"2026-01-14T14:28:14.443604+07:00","close_reason":"Implemented tenant filtering for 8 tools, created resolve_device(), and documented in docs/tools-review.md","dependencies":[{"issue_id":"pfn_mcp-17x","depends_on_id":"pfn_mcp-twt","type":"blocks","created_at":"2026-01-14T14:06:40.330776+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-17x","depends_on_id":"pfn_mcp-at5","type":"blocks","created_at":"2026-01-14T14:06:40.622647+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-1cm","title":"Step 1: Database schema for mcp chat","description":"Create mcp schema with tables: conversations, messages, tenant_branding. See docs/customui/implementation-plan.md for SQL schema.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T13:22:40.931608+07:00","updated_at":"2026-01-12T14:03:38.771327+07:00","closed_at":"2026-01-12T14:03:38.771327+07:00","close_reason":"Created mcp schema with conversations, messages, tenant_branding tables. Changed user_id to VARCHAR for Keycloak subject ID."}
{"id":"pfn_mcp-1hu","title":"Design: Group sync from auth_user_tenants","description":"Design approach to sync Open WebUI groups and LiteLLM teams from existing auth_user_tenants table. Options: 1) Manual creation, 2) Script-based sync, 3) OAuth group claims. Document sync flow and automation strategy. Can be answered without prototyping.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:55:08.987647+07:00","updated_at":"2026-01-05T13:57:29.85312+07:00","closed_at":"2026-01-05T13:57:29.85312+07:00","close_reason":"Design complete. Documented in WEB_UI_PLAN.md. Recommended: Script-based sync from auth_user_tenants to Keycloak, with Open WebUI/LiteLLM auto-syncing from OAuth groups."}
{"id":"pfn_mcp-1om","title":"Custom UI: Tenant branding system","description":"Implement tenant branding from mcp.tenant_branding table. Load logo_url, primary_color, secondary_color, display_name, welcome_message per tenant. Cache per request.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T12:14:14.364451+07:00","updated_at":"2026-01-10T12:14:14.364451+07:00","dependencies":[{"issue_id":"pfn_mcp-1om","depends_on_id":"pfn_mcp-1cm","type":"blocks","created_at":"2026-01-10T12:14:21.832868+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-1p8","title":"Fix telemetry queries for actual DB schema (missing min/max/avg_value columns)","description":"The telemetry_15min_agg table doesn't have min_value, max_value, avg_value columns that the code expects.\n\nAffected tools (16 test failures):\n- get_device_telemetry (telemetry.py)\n- get_quantity_stats (telemetry.py)\n- get_peak_analysis (peak_analysis.py)\n\nFix options:\n1. Query actual columns from DB schema and update queries\n2. Use available aggregation columns (likely: value, sum, count, etc.)\n\nRun: SELECT column_name FROM information_schema.columns WHERE table_name = 'telemetry_15min_agg'","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T11:23:57.45295+07:00","updated_at":"2026-01-06T15:03:47.912469+07:00","closed_at":"2026-01-06T15:03:47.912469+07:00","close_reason":"Fixed column name references: changed min_value/max_value/avg_value/sum_value to aggregated_value in telemetry.py, peak_analysis.py, group_telemetry.py. get_quantity_stats tests now pass. Remaining test failures are due to time_bucket interval issue (tracked in beads-eb4)"}
{"id":"pfn_mcp-24y","title":"Set up LiteLLM budget limits per tenant","description":"Configure per-tenant usage limits in LiteLLM for cost control.\n\nREQUIREMENTS:\n- Map Open WebUI teams/users to tenants\n- Configure monthly budget limits per tenant in LiteLLM\n- Set up usage tracking/reporting\n- Configure alerts for budget thresholds (optional)\n\nDOCS:\n- LiteLLM budget management: https://docs.litellm.ai/docs/proxy/users","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T06:35:58.95375+07:00","updated_at":"2026-01-09T08:42:32.627046+07:00","closed_at":"2026-01-09T08:42:32.627046+07:00","close_reason":"Teams created with $5/month budget (PRS, IOP, NAV). Usage tool deployed showing percentage-based progress. Open WebUI using PRS team key for budget enforcement.","dependencies":[{"issue_id":"pfn_mcp-24y","depends_on_id":"pfn_mcp-d0m","type":"blocks","created_at":"2026-01-08T06:36:05.899235+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-25t","title":"Setup: Grafana org mapping with Keycloak groups","description":"Map Keycloak tenant groups (PRS, IOP, PME_SITE_1, PME_SITE_2) to Grafana organizations via OAuth org_mapping. Users auto-assigned to correct org on login.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T15:52:41.955973+07:00","updated_at":"2026-01-07T16:23:21.473868+07:00","closed_at":"2026-01-07T16:23:21.473868+07:00","close_reason":"Org mapping working. Users auto-assigned to Grafana org based on Keycloak group (PRS→5, IOP→6). Removed deprecated PME_SITE groups."}
{"id":"pfn_mcp-27z","title":"Implement check_data_freshness tool","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T19:43:12.050463+07:00","updated_at":"2025-12-25T20:00:23.958526+07:00","closed_at":"2025-12-25T20:00:23.958526+07:00","close_reason":"All 5 Phase 1 discovery tools implemented and tested"}
{"id":"pfn_mcp-2js","title":"Replace LiteLLM with direct Anthropic SDK","description":"Remove LiteLLM dependency and implement direct Anthropic SDK integration in chat/llm.py. Benefits: better reliability, full control, easier debugging. LiteLLM abstraction causes issues with non-OpenAI providers.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T11:17:26.332245+07:00","updated_at":"2026-01-14T15:10:42.230123+07:00","closed_at":"2026-01-14T15:10:42.230123+07:00","close_reason":"Replaced LiteLLM with direct Anthropic SDK, tool calling working","dependencies":[{"issue_id":"pfn_mcp-2js","depends_on_id":"pfn_mcp-pzn","type":"blocks","created_at":"2026-01-14T11:27:40.488299+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-2uh","title":"Fix datetime timezone bug in Phase 2 tools","description":"Phase 2 tools fail with 'can't subtract offset-naive and offset-aware datetimes' when parsing date parameters. Affected tools: get_electricity_cost, get_electricity_cost_breakdown, get_electricity_cost_ranking, compare_electricity_periods, get_group_telemetry, compare_groups, get_peak_analysis, get_device_telemetry, get_quantity_stats. Root cause: date parsing in parse_period() or similar functions creates naive datetime objects that are then compared with timezone-aware database timestamps. Fix: ensure all datetime objects are timezone-aware (use Asia/Jakarta as per config).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T10:18:06.53721+07:00","updated_at":"2026-01-06T10:42:04.182531+07:00","closed_at":"2026-01-06T10:42:04.182531+07:00","close_reason":"Analysis complete: datetime handling verified. Created datetime_utils.py with helper functions (ensure_utc, to_naive_utc, safe_datetime_diff). Existing parse_period() correctly returns UTC-aware datetimes. All Phase 2 tools use consistent timezone handling. Added 20 unit tests for datetime operations. discovery.py already has defensive handling for database timestamps."}
{"id":"pfn_mcp-2vi","title":"Update schema and wrapper for get_group_telemetry output param","description":"Add output parameter to tools.yaml schema and prototype/pfn_tool_wrapper.py. Add tests for new functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T17:49:34.857641+07:00","updated_at":"2026-01-08T07:09:49.135992+07:00","closed_at":"2026-01-08T07:09:49.135992+07:00","close_reason":"Added output parameter to tools.yaml schema for get_group_telemetry. Supports 'summary' (default) and 'timeseries' modes. Wrapper update deferred per user request.","dependencies":[{"issue_id":"pfn_mcp-2vi","depends_on_id":"pfn_mcp-4ll","type":"blocks","created_at":"2026-01-07T17:49:46.430236+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-35p","title":"Setup: Keycloak client for Open WebUI","description":"Create OIDC client 'openwebui' in Keycloak. Configure redirect URIs, client secret. Add group mapper to include groups in token. Configure Open WebUI env vars for Keycloak.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T14:18:45.874002+07:00","updated_at":"2026-01-07T10:11:26.214146+07:00","closed_at":"2026-01-07T10:11:26.214146+07:00","close_reason":"Completed: Keycloak client configured for Open WebUI with user registration, email verification, login and logout working","dependencies":[{"issue_id":"pfn_mcp-35p","depends_on_id":"pfn_mcp-nta","type":"blocks","created_at":"2026-01-04T14:18:57.681766+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-3b6","title":"Update QUANTITY_ALIASES with engineering-approved mappings","description":"Part 1 of plan. Update src/pfn_mcp/tools/quantities.py with specific patterns for current, voltage, power factor, etc. Depends on engineering review. See: .claude/plans/eager-yawning-marshmallow.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T09:43:30.086935+07:00","updated_at":"2026-01-10T10:07:57.555081+07:00","closed_at":"2026-01-10T10:07:57.555081+07:00","close_reason":"Updated QUANTITY_ALIASES with specific patterns for current, voltage, power factor, THD, unbalance","dependencies":[{"issue_id":"pfn_mcp-3b6","depends_on_id":"pfn_mcp-iw3","type":"blocks","created_at":"2026-01-10T09:43:43.12333+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-3rh","title":"Implement superuser tenant selector","description":"TenantSelector dropdown for superusers. Send X-Tenant-Context header. See plan: .claude/plans/twinkly-waddling-thompson.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:51:49.816389+07:00","updated_at":"2026-01-12T16:17:43.42326+07:00","closed_at":"2026-01-12T16:17:43.42326+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-3rh","depends_on_id":"pfn_mcp-4hp","type":"blocks","created_at":"2026-01-12T15:52:37.81747+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-3rz","title":"Implement get_device_data_range tool","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T19:43:06.867326+07:00","updated_at":"2025-12-25T20:00:23.950941+07:00","closed_at":"2025-12-25T20:00:23.950941+07:00","close_reason":"All 5 Phase 1 discovery tools implemented and tested"}
{"id":"pfn_mcp-3tr","title":"Create get_peak_analysis tool","description":"Create new peak_analysis.py with get_peak_analysis() function. Supports single device and group (tag/asset), returns peak values with timestamps per bucket (hour/day/week). Shows each device's peak for groups. Optional device_daily breakdown.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T16:21:03.596263+07:00","updated_at":"2026-01-06T08:39:25.27878+07:00","closed_at":"2026-01-06T08:39:25.27878+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-3xh","title":"UI: Color System Overhaul","description":"Update globals.css with warm cream/beige palette for light and dark modes. Background: #FAF9F6, Foreground: #1A1915, Accent: #DA7756. Parent epic: pfn_mcp-sdb","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T15:30:06.266211+07:00","updated_at":"2026-01-14T15:39:14.338139+07:00","closed_at":"2026-01-14T15:39:14.338139+07:00","close_reason":"Color system updated with warm cream/beige palette for light mode and warm charcoal for dark mode"}
{"id":"pfn_mcp-40b","title":"resolve_device tool - confirm device selection","description":"Confirm device selection before telemetry queries. Prevents wrong-device from ambiguous fuzzy matches.\n\n## Purpose\nWhen user provides device name (not ID), search could match multiple devices. LLM should call this BEFORE get_device_telemetry when uncertain.\n\n## Parameters\n- search: str (device name search term)\n- tenant_id: int | None (optional filter)\n- limit: int = 5 (max candidates)\n\n## Response\n- Ranked list of matching devices\n- Match confidence (exact/partial/fuzzy)\n- Tenant context for each\n- Device IDs for precise selection\n\n## See also\ndocs/phase2-telemetry.md for full spec","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-25T20:22:12.136461+07:00","updated_at":"2025-12-27T08:28:20.253743+07:00","closed_at":"2025-12-27T08:28:20.253743+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-46a","title":"Step 4: Chat API endpoints","description":"Implement chat API endpoints: POST /api/chat (SSE streaming), GET/DELETE /api/conversations, GET /api/usage. See docs/customui/implementation-plan.md for full endpoint list.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T13:22:42.401294+07:00","updated_at":"2026-01-12T14:54:23.16081+07:00","closed_at":"2026-01-12T14:54:23.16081+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-46a","depends_on_id":"pfn_mcp-6aw","type":"blocks","created_at":"2026-01-04T13:22:52.76979+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-46y","title":"Configure Keycloak auth flow to block users without groups","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:22:09.169406+07:00","updated_at":"2026-01-07T11:33:09.22436+07:00","closed_at":"2026-01-07T11:33:09.22436+07:00","close_reason":"Configured Keycloak: created approved-user client role, assigned to all tenant groups, created 'Browser with Approval' auth flow with conditional deny, bound to openwebui client"}
{"id":"pfn_mcp-4hp","title":"Implement OAuth login flow","description":"Login page + OAuth callback handler + AuthContext. Store JWT in localStorage. See plan: .claude/plans/twinkly-waddling-thompson.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:51:48.278796+07:00","updated_at":"2026-01-12T16:16:05.033663+07:00","closed_at":"2026-01-12T16:16:05.033663+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-4hp","depends_on_id":"pfn_mcp-ilx","type":"blocks","created_at":"2026-01-12T15:52:36.4557+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-4jr","title":"Custom UI: Capacitor mobile wrapper","description":"Wrap Next.js app in Capacitor for iOS/Android app stores. Handle OAuth deep linking, keyboard UX, safe area insets. Target: 3 months after web launch.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T12:14:15.128548+07:00","updated_at":"2026-01-10T12:14:15.128548+07:00","dependencies":[{"issue_id":"pfn_mcp-4jr","depends_on_id":"pfn_mcp-mmg","type":"blocks","created_at":"2026-01-10T12:14:22.397469+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-4ll","title":"Add time-series output format (Format B)","description":"Implement _get_telemetry_timeseries() returning time-aligned rows: [{time, device_1, device_2, ...}]. Update formatter to handle timeseries output. File: src/pfn_mcp/tools/group_telemetry.py","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T17:49:34.412956+07:00","updated_at":"2026-01-08T06:57:11.504035+07:00","closed_at":"2026-01-08T06:57:11.504035+07:00","close_reason":"Implemented _get_telemetry_timeseries() function that pivots device rows into time-aligned columns [{time, device_1, device_2, ...}]. Added timeseries output mode to _get_telemetry_group_summary. Updated formatter with _format_timeseries_response(). Added 10 new tests (56 total in group_telemetry, 158 total passing).","dependencies":[{"issue_id":"pfn_mcp-4ll","depends_on_id":"pfn_mcp-fb7","type":"blocks","created_at":"2026-01-07T17:49:46.023544+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-4uk","title":"Optimize get_device_info for Modbus search (IP+slave_id)","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-07T09:32:25.125464+07:00","updated_at":"2026-01-07T09:32:37.837497+07:00","closed_at":"2026-01-07T09:32:37.837497+07:00","close_reason":"Implemented: get_device_info now supports ip_address + slave_id search for direct Modbus lookup, avoiding brute-force device iteration"}
{"id":"pfn_mcp-51z","title":"Add conversation sidebar","description":"ConversationList component. Fetch from /api/conversations, create/delete/select. See plan: .claude/plans/twinkly-waddling-thompson.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:51:56.106627+07:00","updated_at":"2026-01-12T16:16:05.8164+07:00","closed_at":"2026-01-12T16:16:05.8164+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-51z","depends_on_id":"pfn_mcp-y9m","type":"blocks","created_at":"2026-01-12T15:52:37.414103+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-598","title":"Create sys-prompt-ver-2-condensed.md","description":"Condensed prompt ~1500 tokens. 50% reduction target. Plan: ~/.claude/plans/concurrent-finding-anchor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T12:44:17.805978+07:00","updated_at":"2026-01-15T13:16:09.589311+07:00","closed_at":"2026-01-15T13:16:09.589311+07:00","close_reason":"Created sys-prompt-ver-2-condensed.md (~1500 tokens)","dependencies":[{"issue_id":"pfn_mcp-598","depends_on_id":"pfn_mcp-f58","type":"blocks","created_at":"2026-01-15T12:44:25.288725+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-5i7","title":"Create sys-prompt-ver-4-toolsearch.md","description":"Tool Search optimized prompt ~1000 tokens. No tool definitions. Plan: ~/.claude/plans/concurrent-finding-anchor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T12:44:18.687561+07:00","updated_at":"2026-01-15T13:16:48.519494+07:00","closed_at":"2026-01-15T13:16:48.519494+07:00","close_reason":"Created sys-prompt-ver-4-toolsearch.md (~1000 tokens)","dependencies":[{"issue_id":"pfn_mcp-5i7","depends_on_id":"pfn_mcp-f58","type":"blocks","created_at":"2026-01-15T12:44:26.312803+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-5l8","title":"Create sys-prompt-ver-1-full.md","description":"Baseline system prompt ~3000 tokens. Fix get_electricity_cost_breakdown reference. Plan: ~/.claude/plans/concurrent-finding-anchor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T12:44:17.270727+07:00","updated_at":"2026-01-15T13:15:39.23545+07:00","closed_at":"2026-01-15T13:15:39.23545+07:00","close_reason":"Created sys-prompt-ver-1-full.md with fixed tool names and all sections","dependencies":[{"issue_id":"pfn_mcp-5l8","depends_on_id":"pfn_mcp-f58","type":"blocks","created_at":"2026-01-15T12:44:24.993375+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-62u","title":"Deploy sync as cron/systemd timer","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:22:15.09775+07:00","updated_at":"2026-01-07T12:07:08.617869+07:00","closed_at":"2026-01-07T12:07:08.617869+07:00","close_reason":"Added crontab deployment instructions to docs/user-registration-flow.md","dependencies":[{"issue_id":"pfn_mcp-62u","depends_on_id":"pfn_mcp-d7d","type":"blocks","created_at":"2026-01-07T11:22:22.735472+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-6am","title":"Skip group telemetry tests when tags don't exist in database","description":"Group telemetry tests fail because 'process' and 'building' tags don't exist in the test database.\n\nAffected tests (2 failures):\n- test_process_group_consumption\n- test_building_power_usage\n\nFix: Add pytest.mark.skipif or check tag existence before test, similar to how sample_tag fixture handles missing tags.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T11:23:58.418713+07:00","updated_at":"2026-01-07T10:16:02.290028+07:00","closed_at":"2026-01-07T10:16:02.290028+07:00","close_reason":"Tests already have skip logic implemented (lines 53-54, 73-74 in test_phase2_group_telemetry.py). Verified both tests pass."}
{"id":"pfn_mcp-6ar","title":"Prototype: Verify __user__ context in Open WebUI Python tools","description":"Deploy Open WebUI locally. Create a test Python tool plugin that uses __user__ injection to get user context (id, email, groups). Verify that Keycloak groups appear in __user__ after OAuth login. Document: 1) __user__ dict structure, 2) How to extract tenant from groups. NOTE: Research found MCPO doesn't pass user context - use native Python tools instead.\n\nVERIFICATION COMPLETE (2026-01-06):\n\nFINDINGS:\n1. __user__ dict IS injected with: id, email, name, role, oauth_sub, timestamps\n2. Keycloak groups are NOT synced to Open WebUI despite ENABLE_OAUTH_GROUP_MANAGEMENT=true\n3. Groups.get_groups_by_member_id() returns EMPTY\n4. The oauth field only stores: {\"oidc\": {\"sub\": \"...\"}}\n\nCONCLUSION: Cannot extract tenant from groups using current approach.\n\nALTERNATIVES FOR pfn_mcp-dvl:\n1. Store tenant in user.info JSON (custom OAuth callback)\n2. Manual group sync in Open WebUI Admin\n3. Map oauth_sub → tenant in PFN backend\n4. Use email domain as tenant indicator","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:55:21.701946+07:00","updated_at":"2026-01-06T09:17:30.164424+07:00","closed_at":"2026-01-06T09:17:30.164424+07:00","close_reason":"Verification complete. __user__ works but Keycloak groups NOT synced. See README.md for alternatives.","dependencies":[{"issue_id":"pfn_mcp-6ar","depends_on_id":"pfn_mcp-7hb","type":"blocks","created_at":"2026-01-04T13:55:28.888753+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-6aw","title":"Step 3: LLM integration via LiteLLM","description":"Implement multi-model LLM integration via LiteLLM (Claude, MiniMax M2, etc). Create tool_registry.py mapping tool names to functions, tool_executor.py for tenant injection, and claude.py (renamed llm.py) for streaming chat completion.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T13:22:41.926936+07:00","updated_at":"2026-01-12T14:33:51.475064+07:00","closed_at":"2026-01-12T14:33:51.475064+07:00","close_reason":"Implemented multi-model LLM integration via LiteLLM with tool_registry (23 tools), tool_executor (tenant injection), and llm.py (streaming client). Supports Claude, MiniMax M2, and any LiteLLM-compatible model.","dependencies":[{"issue_id":"pfn_mcp-6aw","depends_on_id":"pfn_mcp-85p","type":"blocks","created_at":"2026-01-04T13:22:52.490221+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-6cj","title":"Consolidate electricity cost tools","description":"Merge get_electricity_cost and get_electricity_cost_breakdown into single tool with expanded group_by options. Add daily_rate and daily_shift groupings. See plan: .claude/plans/tool-consolidation.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-10T10:04:18.619525+07:00","updated_at":"2026-01-10T10:33:47.028424+07:00","closed_at":"2026-01-10T10:33:47.028424+07:00","close_reason":"Completed - consolidated electricity cost tools with extended group_by options"}
{"id":"pfn_mcp-6z9","title":"Add search_tags handler to server.py","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:52:52.096224+07:00","updated_at":"2026-01-07T16:58:03.119231+07:00","closed_at":"2026-01-07T16:58:03.119231+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-6z9","depends_on_id":"pfn_mcp-d8p","type":"blocks","created_at":"2026-01-07T16:52:58.746649+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-6zq","title":"Create tool-search-guide.md","description":"Document Tool Search Tool integration with MCP. Include defer_loading settings. Plan: ~/.claude/plans/concurrent-finding-anchor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T12:44:19.111365+07:00","updated_at":"2026-01-15T13:18:33.583791+07:00","closed_at":"2026-01-15T13:18:33.583791+07:00","close_reason":"Created comprehensive docs/tool-search-guide.md with MCP integration examples"}
{"id":"pfn_mcp-71m","title":"UI: Typography \u0026 Spacing","description":"Adjust Geist font sizing, line-heights (1.6-1.7), increase whitespace throughout. Message gap 24-32px. Parent epic: pfn_mcp-sdb","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T15:30:15.814943+07:00","updated_at":"2026-01-14T16:03:39.240141+07:00","closed_at":"2026-01-14T16:03:39.240141+07:00","close_reason":"Typography and spacing updated: line-heights, prose styling, generous whitespace throughout","dependencies":[{"issue_id":"pfn_mcp-71m","depends_on_id":"pfn_mcp-3xh","type":"blocks","created_at":"2026-01-14T15:30:32.068515+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-73r","title":"Add Indonesian electricity terminology to tool descriptions","description":"Add WBP/LWBP explanations to tools.yaml and response formatters. WBP=Waktu Beban Puncak (Peak), LWBP=Luar WBP (Off-Peak). Also document SHIFT1/2/3 time ranges.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T10:04:27.124932+07:00","updated_at":"2026-01-10T10:33:47.024159+07:00","closed_at":"2026-01-10T10:33:47.024159+07:00","close_reason":"Completed - consolidated electricity cost tools with extended group_by options"}
{"id":"pfn_mcp-7hb","title":"Research: Open WebUI MCP user context passing","description":"Research Open WebUI documentation and source code to understand how user context is passed to MCP servers. Look for: headers, metadata, __user__ injection. Document findings before prototyping. Can be answered without prototyping.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:55:09.396322+07:00","updated_at":"2026-01-05T13:44:10.673761+07:00","closed_at":"2026-01-05T13:44:10.673761+07:00","close_reason":"Research complete. Documented in WEB_UI_PLAN.md. Key finding: MCPO does NOT pass user context to MCP servers. Recommended workaround: Use native Python tools with __user__ injection."}
{"id":"pfn_mcp-7yr","title":"Implement get_tenant_summary tool","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T19:43:13.08592+07:00","updated_at":"2025-12-25T20:00:23.959795+07:00","closed_at":"2025-12-25T20:00:23.959795+07:00","close_reason":"All 5 Phase 1 discovery tools implemented and tested"}
{"id":"pfn_mcp-85p","title":"Step 2: Backend auth with JWT","description":"Implement Keycloak OAuth flow with JWT token creation. Include tenant resolution from Keycloak groups and superuser tenant switching via X-Tenant-Context header.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T13:22:41.478675+07:00","updated_at":"2026-01-12T14:15:25.192578+07:00","closed_at":"2026-01-12T14:15:25.192578+07:00","close_reason":"Implemented Keycloak OAuth flow with JWT, tenant resolution from groups, superuser X-Tenant-Context switching","dependencies":[{"issue_id":"pfn_mcp-85p","depends_on_id":"pfn_mcp-1cm","type":"blocks","created_at":"2026-01-04T13:22:52.211037+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-86y","title":"Extend get_group_telemetry for all WAGE quantities","description":"Add quantity_id/quantity_search parameters to get_group_telemetry. When quantity specified, query telemetry_15min_agg instead of daily_energy_cost_summary. Support instantaneous (AVG) and cumulative (SUM) aggregation rules.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T16:21:04.001369+07:00","updated_at":"2026-01-06T08:46:35.439595+07:00","closed_at":"2026-01-06T08:46:35.439595+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-8hj","title":"Add tests for search_tags","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:52:52.510447+07:00","updated_at":"2026-01-07T16:59:28.620809+07:00","closed_at":"2026-01-07T16:59:28.620809+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-8hj","depends_on_id":"pfn_mcp-nnx","type":"blocks","created_at":"2026-01-07T16:52:59.039573+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-8op","title":"Add Grafana quick link to Open WebUI","description":"Add Action Function that provides a button to open Grafana (https://viz.forsanusa.id/graf) in new tab.\n\nPROGRESS:\n- Created prototype/openwebui_grafana_action.py\n- Function installed in Open WebUI Admin → Functions\n\nBLOCKER:\nAction Functions appear in message toolbar (attached to chat responses). Without a model configured, there are no messages to attach the button to.\n\nOPTIONS TO RESOLVE:\n1. Configure a model in Open WebUI first, then test\n2. Convert to Tool type instead of Action (shows in tools dropdown)\n3. Consider frontend fork for navbar link (better UX but more maintenance)\n\nFILES:\n- prototype/openwebui_grafana_action.py - Ready to use once model is available\n\nRELATED:\n- Keycloak SSO working (pfn_mcp-dn3)\n- Grafana org mapping working (pfn_mcp-25t)\n- Fixed openwebui Keycloak flow (was using 'Browser with Approval' custom flow)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T16:44:28.723407+07:00","updated_at":"2026-01-09T08:08:00.439793+07:00","closed_at":"2026-01-09T08:08:00.439793+07:00","close_reason":"Action working - icon shows in message toolbar, redirects to Grafana. Tools default enabled via Workspace → Models settings.","dependencies":[{"issue_id":"pfn_mcp-8op","depends_on_id":"pfn_mcp-d0m","type":"blocks","created_at":"2026-01-08T06:36:09.908261+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-8ui","title":"Add cumulative quantity warning to get_device_telemetry","description":"Detect cumulative quantities and add warning recommending get_energy_consumption tool.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:13:07.129972+07:00","updated_at":"2026-01-07T16:23:04.621789+07:00","closed_at":"2026-01-07T16:23:04.621789+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-8vv","title":"UI: Final Polish \u0026 QA","description":"Cross-browser testing, responsive check (mobile/tablet/desktop), dark mode consistency, accessibility audit (contrast ratios). Parent epic: pfn_mcp-sdb","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-14T15:30:08.944567+07:00","updated_at":"2026-01-14T15:30:08.944567+07:00","dependencies":[{"issue_id":"pfn_mcp-8vv","depends_on_id":"pfn_mcp-71m","type":"blocks","created_at":"2026-01-14T15:30:34.172888+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-8vv","depends_on_id":"pfn_mcp-z0h","type":"blocks","created_at":"2026-01-14T15:30:34.599811+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-8vv","depends_on_id":"pfn_mcp-xpm","type":"blocks","created_at":"2026-01-14T15:30:35.11391+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-8vv","depends_on_id":"pfn_mcp-9ab","type":"blocks","created_at":"2026-01-14T15:30:35.551223+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-9ab","title":"UI: Sidebar \u0026 Layout Polish","description":"Clean navigation, reduce chrome, remove heavy borders, subtle hover states. Reduce header height 56px→48px. Parent epic: pfn_mcp-sdb","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T15:30:08.374067+07:00","updated_at":"2026-01-14T19:23:04.40671+07:00","closed_at":"2026-01-14T19:23:04.40671+07:00","close_reason":"Sidebar polished: reduced header height, subtle borders, three-dot menu for rename/delete, replaced ScrollArea with overflow-auto, proper title truncation","dependencies":[{"issue_id":"pfn_mcp-9ab","depends_on_id":"pfn_mcp-3xh","type":"blocks","created_at":"2026-01-14T15:30:33.687216+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-9d6","title":"Fix check_data_freshness response structure","description":"check_data_freshness() returns dict without expected keys (devices, summary, stale, offline). Test: test_check_offline_meters, test_find_offline_meters. Need to verify response structure matches expected format.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T10:18:19.286035+07:00","updated_at":"2026-01-06T11:04:07.257003+07:00","closed_at":"2026-01-06T11:04:07.257003+07:00","close_reason":"Fixed test: added required tenant_id parameter and updated assertions to match actual response structure (devices, status_summary, device_count)"}
{"id":"pfn_mcp-9ew","title":"Setup: Keycloak realm and SMTP","description":"Deploy Keycloak with PostgreSQL. Create 'pfn' realm. Configure SMTP for email verification. Enable self-registration with email verification. Test registration flow.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T14:18:45.016868+07:00","updated_at":"2026-01-06T15:59:52.64871+07:00","closed_at":"2026-01-06T15:59:52.64871+07:00","close_reason":"Keycloak deployed with PostgreSQL, pfn realm created, SMTP configured with email verification, self-registration enabled and tested"}
{"id":"pfn_mcp-9zg","title":"Custom UI: Superuser tenant switching","description":"Implement tenant dropdown in header for superusers. Send X-Tenant-Context header to switch context. Backend validates and applies tenant filter.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T12:14:14.74843+07:00","updated_at":"2026-01-10T12:14:14.74843+07:00","dependencies":[{"issue_id":"pfn_mcp-9zg","depends_on_id":"pfn_mcp-85p","type":"blocks","created_at":"2026-01-10T12:14:22.118272+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-aq0","title":"Phase 1: Foundation \u0026 Data Mapping","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-25T10:31:24.982778+07:00","updated_at":"2025-12-25T11:20:55.233356+07:00","closed_at":"2025-12-25T11:20:55.233356+07:00","close_reason":"Phase 1 complete: MCP server with list_quantities, list_devices, list_tenants tools"}
{"id":"pfn_mcp-at5","title":"Extract quantity alias helper to quantities.py","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T14:06:31.365819+07:00","updated_at":"2026-01-14T14:49:40.826362+07:00","closed_at":"2026-01-14T14:49:40.826362+07:00","close_reason":"Implemented expand_quantity_aliases() helper in quantities.py and updated 6 locations across 4 files"}
{"id":"pfn_mcp-atx","title":"Add canonical mappings to tools.yaml descriptions","description":"Part 2 of plan. Enhance get_device_telemetry and other tool descriptions with engineering term defaults. See: .claude/plans/eager-yawning-marshmallow.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T09:43:30.505491+07:00","updated_at":"2026-01-10T10:33:47.006897+07:00","closed_at":"2026-01-10T10:33:47.006897+07:00","close_reason":"Completed - consolidated electricity cost tools with extended group_by options","dependencies":[{"issue_id":"pfn_mcp-atx","depends_on_id":"pfn_mcp-iw3","type":"blocks","created_at":"2026-01-10T09:43:43.413341+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-b83","title":"Add output parameter and smart bucketing to get_group_telemetry","description":"Add output param (summary|timeseries|per_device) and select_group_bucket() function to limit rows to ~200 based on device count × time range. File: src/pfn_mcp/tools/group_telemetry.py","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T17:49:33.597666+07:00","updated_at":"2026-01-07T17:55:42.968472+07:00","closed_at":"2026-01-07T17:55:42.968472+07:00","close_reason":"Added select_group_bucket() for smart bucketing and output parameter to get_group_telemetry. Tests added and passing (35 total)."}
{"id":"pfn_mcp-bg6","title":"Verify integration tests pass after bug fixes","description":"After fixing timezone bug (pfn_mcp-2uh) and response structure bugs, re-run pytest tests/ -v and verify all 57 tests pass. Update docs/testing-phase-1-2.md with results.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T10:18:27.512913+07:00","updated_at":"2026-01-06T11:18:30.953303+07:00","closed_at":"2026-01-06T11:18:30.953303+07:00","close_reason":"Integration tests verified: 55/77 passed (71%). Datetime timezone bug fixed. Remaining failures are schema mismatches (min_value/max_value columns), not datetime related.","dependencies":[{"issue_id":"pfn_mcp-bg6","depends_on_id":"pfn_mcp-2uh","type":"blocks","created_at":"2026-01-06T10:18:32.549295+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-bg6","depends_on_id":"pfn_mcp-9d6","type":"blocks","created_at":"2026-01-06T10:18:32.868954+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-bg6","depends_on_id":"pfn_mcp-ij7","type":"blocks","created_at":"2026-01-06T10:18:33.151123+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-bg6","depends_on_id":"pfn_mcp-e9v","type":"blocks","created_at":"2026-01-06T10:18:33.470686+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-bvj","title":"Fix test assertions for API response structure mismatches","description":"Two tests have assertions that don't match actual API response structures:\n\n1. test_process_group_consumption (test_phase2_group_telemetry.py)\n   - Expects: ['consumption', 'total', 'data', 'telemetry']\n   - Actual: ['group', 'quantity', 'summary']\n\n2. test_find_offline_meters (test_combined_scenarios.py)\n   - Expects: ['devices', 'summary', 'stale', 'offline']\n   - Actual: different structure from check_data_freshness()\n\nFix: Update test assertions to match actual API response keys.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T16:04:52.841753+07:00","updated_at":"2026-01-06T16:27:53.667502+07:00","closed_at":"2026-01-06T16:27:53.667502+07:00","close_reason":"Fixed test assertions to match actual API response structures. test_process_group_consumption now checks for 'summary' with 'total_consumption_kwh'. test_find_offline_meters now uses sample_tenant fixture and checks for 'devices' and 'status_summary'. All 82 tests pass."}
{"id":"pfn_mcp-bwx","title":"Set up MCP server project structure","description":"Initialize Python project with mcp SDK, pyproject.toml, src layout, and basic server scaffold","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T10:31:38.574861+07:00","updated_at":"2025-12-25T10:39:14.027019+07:00","closed_at":"2025-12-25T10:39:14.027019+07:00","close_reason":"Project structure created with pyproject.toml, src layout, MCP server scaffold, and .env.example"}
{"id":"pfn_mcp-c44","title":"Implement list_quantities tool","description":"MCP tool to browse available metrics with WAGE categories, units, and aggregation methods. Query quantities table with semantic grouping.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T10:31:39.428738+07:00","updated_at":"2025-12-25T11:09:36.202173+07:00","closed_at":"2025-12-25T11:09:36.202173+07:00","close_reason":"Implemented with category/search filters, semantic aliases (energy, power, voltage, etc.), in_use_only filter, and formatted output","dependencies":[{"issue_id":"pfn_mcp-c44","depends_on_id":"pfn_mcp-tmd","type":"blocks","created_at":"2025-12-25T10:32:02.972315+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-c86","title":"Phase 4: Web-Based Chat UI","description":"Custom Chat UI replacing Open WebUI. Next.js frontend + FastAPI backend with direct Python tool execution. See docs/customui/implementation-plan.md for full plan.\n\nKey features:\n- Direct tool execution (no mcpo layer)\n- Per-tenant branding (logo, colors from database)\n- Superuser tenant switching via dropdown\n- User-isolated conversations\n- LiteLLM for Claude API + budget tracking\n\nTimeline: 6 weeks MVP","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-04T13:22:21.365906+07:00","updated_at":"2026-01-10T12:13:38.28074+07:00"}
{"id":"pfn_mcp-cfk","title":"get_device_telemetry tool - core time-series query","description":"Core Phase 2 tool. Fetch aggregated telemetry data for a device.\n\n## Key Features\n- Adaptive bucketing based on time range\n- Multiple aggregation stats (avg, min, max, sum, count)\n- Period-based or explicit date range\n- Quantity semantic search support\n\n## Parameters\n- device_id/device_name: device selection\n- quantity_id/quantity_search: metric selection\n- period OR start_date/end_date: time range\n- bucket: '15min', '1hour', '1day', 'auto'\n\n## Adaptive Buckets\n- ≤24h → 15min buckets\n- ≤7d → 1hour buckets\n- ≤30d → 4hour buckets\n- ≤90d → 1day buckets\n- \u003e90d → 1week buckets\n\n## Data Source\nPrimary: telemetry_15min_agg (2 years)\nFallback: telemetry_data (14 days raw)\n\n## See also\ndocs/phase2-telemetry.md for full spec","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-25T20:22:13.350034+07:00","updated_at":"2025-12-27T08:37:31.128773+07:00","closed_at":"2025-12-27T08:37:31.128773+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-cfk","depends_on_id":"pfn_mcp-40b","type":"blocks","created_at":"2025-12-25T20:22:22.698364+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-d0l","title":"Support multi-tag queries in get_group_telemetry","description":"Extend get_group_telemetry to accept multiple tag filters with AND logic. Currently only supports single tag_key/tag_value pair. Use case: Query 'all compressors in Factory B' by filtering building=Factory B AND equipment_type=Compressor. Changes: 1) Add 'tags' array param to get_group_telemetry 2) Modify _resolve_tag_devices for multi-tag AND conditions 3) Update search_tags to show devices' full tag sets. See docs/tagging-system.md for context.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-07T17:14:37.490331+07:00","updated_at":"2026-01-07T17:24:56.878967+07:00","closed_at":"2026-01-07T17:24:56.878967+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-d0m","title":"Configure LiteLLM with Claude model","description":"Set up LiteLLM to proxy requests to Claude API (Anthropic).\n\nREQUIREMENTS:\n- Add Claude model configuration to LiteLLM\n- Configure API key securely\n- Test basic chat completion works in Open WebUI\n\nUNBLOCKS:\n- Grafana quick link button (pfn_mcp-8op) - needs a model to attach action to messages\n- MCP tool integration\n- Budget enforcement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T06:35:58.14773+07:00","updated_at":"2026-01-08T17:13:30.980383+07:00","closed_at":"2026-01-08T17:13:30.980383+07:00","close_reason":"LiteLLM configured with Claude Sonnet, MCP tools working in Open WebUI"}
{"id":"pfn_mcp-d3o","title":"Fix instantaneous quantity aggregation in group telemetry","description":"**Problem:**\nWhen `get_group_telemetry` returns multiple devices for instantaneous quantities (voltage, power, current), it:\n1. AVGs all values across all devices and time into a single number (meaningless)\n2. Shows percentage in device breakdown (nonsense for instantaneous values)\n3. Loses device context for min/max\n\n**Example:** 5 compressors, query 'Voltage Phase A'\n- Current: Returns avg_value=225V (useless - which machine is at 225V?)\n- Expected: Per-device averages by default: Comp-01=220V, Comp-02=230V, etc.\n\n**Contrast with `get_device_telemetry` (single device):**\n- Returns time-series with avg/min/max per bucket\n- User sees temporal variation\n\n**Fix:**\n1. For instantaneous quantities, default to breakdown='device'\n2. Skip percentage calculation for instantaneous quantities\n3. Add min/max with device attribution in summary\n\n**Files:**\n- src/pfn_mcp/tools/group_telemetry.py:675-757 (aggregation logic)\n- src/pfn_mcp/tools/group_telemetry.py:760-817 (device breakdown)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T17:33:27.556769+07:00","updated_at":"2026-01-08T07:53:21.23863+07:00","closed_at":"2026-01-08T07:53:21.23863+07:00","close_reason":"Fixed instantaneous quantity aggregation: auto-enables device breakdown for multiple devices, skips percentage calculation, adds min/max device attribution in summary","dependencies":[{"issue_id":"pfn_mcp-d3o","depends_on_id":"pfn_mcp-2vi","type":"blocks","created_at":"2026-01-07T17:49:46.823396+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-d5s","title":"Epic: System Prompt \u0026 Tool Search Optimization","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-15T12:44:05.45256+07:00","updated_at":"2026-01-15T12:44:05.45256+07:00"}
{"id":"pfn_mcp-d71","title":"Implement get_electricity_cost tool","description":"Primary electricity cost query tool. Returns consumption and cost for a device or tenant with optional breakdown.\n\n**Reference:** docs/electricity_cost_tools.md\n\n**Parameters:**\n- device: Device name (fuzzy match)\n- tenant: Tenant name (fuzzy match)  \n- period: Time period (7d, 1M, 2025-12, etc.)\n- start_date/end_date: Explicit date range\n- breakdown: none, daily, shift, rate, source\n\n**Data source:** daily_energy_cost_summary table (quantity_id=124 for Active Energy)\n\n**Implementation notes:**\n- Use existing resolve_device pattern for fuzzy matching\n- Support multiple period formats (relative, month, range)\n- Handle NULL cost for devices without utility mapping\n- Aggregate by summing total_cost (not recalculating)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T08:58:36.781407+07:00","updated_at":"2025-12-27T10:13:54.455603+07:00","closed_at":"2025-12-27T10:13:54.455603+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-d76","title":"Implement list_tenants tool","description":"MCP tool to list available tenants with basic info (name, device count, etc.)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T10:31:40.295787+07:00","updated_at":"2025-12-25T11:20:50.94033+07:00","closed_at":"2025-12-25T11:20:50.94033+07:00","close_reason":"Implemented with device counts per tenant, formatted output with description","dependencies":[{"issue_id":"pfn_mcp-d76","depends_on_id":"pfn_mcp-tmd","type":"blocks","created_at":"2025-12-25T10:32:03.767011+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-d7d","title":"Create sync script (Keycloak → auth_user_tenants)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:22:09.60102+07:00","updated_at":"2026-01-07T11:55:43.012821+07:00","closed_at":"2026-01-07T11:55:43.012821+07:00","close_reason":"Created sync_keycloak_to_valkyrie.py with full sync logic"}
{"id":"pfn_mcp-d8p","title":"Register search_tags in tools.yaml","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:52:51.687803+07:00","updated_at":"2026-01-07T16:56:29.786571+07:00","closed_at":"2026-01-07T16:56:29.786571+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-d8p","depends_on_id":"pfn_mcp-nnx","type":"blocks","created_at":"2026-01-07T16:52:58.450041+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-daz","title":"Research: OAuth provider options for Open WebUI","description":"Evaluate OAuth/OIDC providers for Open WebUI auth. Options: Google Workspace, Azure AD, existing auth_users sync. Consider: team's existing infrastructure, ease of group claim mapping, tenant isolation requirements. Can be answered without prototyping.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:55:08.574662+07:00","updated_at":"2026-01-04T14:17:53.477934+07:00","closed_at":"2026-01-04T14:17:53.477934+07:00","close_reason":"Research complete: Keycloak selected. Supports email registration with verification, conditional MFA, Grafana SSO. Details in docs/WEB_UI_PLAN.md"}
{"id":"pfn_mcp-de9","title":"Step 5: Usage tracking and limits","description":"Implement usage tracking via LiteLLM team budget API. Display percentage-based usage meter (no dollar amounts shown to users).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:22:42.856096+07:00","updated_at":"2026-01-12T15:24:56.370014+07:00","closed_at":"2026-01-12T15:24:56.370014+07:00","close_reason":"Implemented usage tracking with LiteLLM cost calculation and budget enforcement","dependencies":[{"issue_id":"pfn_mcp-de9","depends_on_id":"pfn_mcp-46a","type":"blocks","created_at":"2026-01-04T13:22:53.065313+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-dn3","title":"Setup: Keycloak client for Grafana","description":"Create OIDC client 'grafana' in Keycloak. Configure grafana.ini for Keycloak OAuth. Set auto_login=true. Test SSO from Web UI to Grafana. Configure role mapping.\n\nPROGRESS (2026-01-07):\n✅ Created OIDC client 'grafana' in Keycloak pfn realm\n✅ Client UUID: 53e5dc47-e139-4f53-9318-160dace5c91c\n✅ Client Secret: sXRL2VaFxVEtbGHp1s5KmfBRs5sLFtm1\n✅ Created group membership mapper\n✅ Created role mapper\n✅ Documented in prototype/README.md\n✅ Created setup script: prototype/setup_grafana_keycloak.py\n\nREMAINING:\n⏳ Apply env vars to Grafana on VPS\n⏳ Test SSO login at https://viz.forsanusa.id","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T14:18:46.315625+07:00","updated_at":"2026-01-07T15:36:53.614905+07:00","closed_at":"2026-01-07T15:36:53.614905+07:00","close_reason":"SSO working. Created Keycloak client 'grafana', configured grafana.ini OAuth, resolved email conflict issue. Users auto-assigned to org_id=1 with Viewer role.","dependencies":[{"issue_id":"pfn_mcp-dn3","depends_on_id":"pfn_mcp-nta","type":"blocks","created_at":"2026-01-04T14:18:57.960807+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-drk","title":"Timezone display (UTC+7) in telemetry formatters","description":"Show timestamps in Asia/Jakarta (UTC+7) timezone instead of UTC. Infrastructure exists in datetime_utils.py. See: docs/playground/time_format_update.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-07T11:16:00.255587+07:00","updated_at":"2026-01-07T11:25:41.443573+07:00","closed_at":"2026-01-07T11:25:41.443573+07:00","close_reason":"Implemented timezone display (WIB) in telemetry formatters"}
{"id":"pfn_mcp-dvl","title":"Prototype: Python plugin wrapper for tenant-scoped tools","description":"End-to-end test with Python plugin wrapper approach: 1) Create Open WebUI Python tool that wraps PFN MCP functions, 2) Tool uses __user__['groups'] to get tenant, 3) Tool calls existing PFN functions with tenant_id, 4) Verify user only sees their tenant's data. NOTE: Use Python plugins with __user__ injection, NOT direct MCP via MCPO.\n\nCOMPLETED (2026-01-06):\nCreated pfn_tool_wrapper.py with:\n- Lazy-loading tenant resolution from Keycloak\n- Caching in user.info field\n- Example tools: get_my_tenant, list_devices, get_consumption, get_electricity_cost\n- Valves for admin configuration\n\nKey pattern:\n1. Check __user__.info.tenant_code (cached)\n2. If missing, fetch from Keycloak via oauth_sub\n3. Cache result for future calls\n4. Execute tool with tenant filter\n\nFiles:\n- prototype/pfn_tool_wrapper.py (production-ready)\n- prototype/sync_keycloak_groups.py (background sync alternative)\n- prototype/README.md (updated documentation)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:55:22.527014+07:00","updated_at":"2026-01-06T10:09:58.293217+07:00","closed_at":"2026-01-06T10:09:58.293217+07:00","close_reason":"Implemented pfn_tool_wrapper.py with lazy-loading tenant resolution from Keycloak","dependencies":[{"issue_id":"pfn_mcp-dvl","depends_on_id":"pfn_mcp-6ar","type":"blocks","created_at":"2026-01-04T13:55:29.181365+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-dvl","depends_on_id":"pfn_mcp-j8e","type":"blocks","created_at":"2026-01-04T13:55:29.457149+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-e9v","title":"Fix resolve_device response for exact match","description":"resolve_device() response for exact matches doesn't include expected confidence/match_type fields. Test: test_resolve_exact_device. When a device is resolved exactly, the response should indicate match confidence.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T10:18:20.150708+07:00","updated_at":"2026-01-06T10:54:33.760178+07:00","closed_at":"2026-01-06T10:54:33.760178+07:00","close_reason":"Fixed resolve_device response: renamed match_confidence to confidence and added match_type field. Both fields now match test expectations."}
{"id":"pfn_mcp-eb4","title":"Fix time_bucket interval parameter handling in telemetry queries","description":"asyncpg.exceptions.DataError: invalid input for query argument: '15 minutes' ('str' object has no attribute 'days')\n\nThe time_bucket function receives interval as string (e.g. '15 minutes', '1 hour') but asyncpg cannot convert it properly even with ::interval cast.\n\nAffected tests:\n- test_power_consumption_24h\n- test_energy_usage_last_week  \n- test_custom_date_range\n- test_current_readings_yesterday\n- test_peak_* tests\n- test_group_* telemetry tests\n\nFix options:\n1. Use PostgreSQL interval syntax directly in query\n2. Use timedelta objects instead of strings\n3. Investigate asyncpg interval parameter handling","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T15:02:59.518144+07:00","updated_at":"2026-01-06T15:42:28.660315+07:00","closed_at":"2026-01-06T15:42:28.660315+07:00","close_reason":"Fixed time_bucket interval handling by using timedelta objects instead of strings. Also fixed placeholder position bug in peak_analysis stats_query. 15 tests now passing. Remaining 2 failures are pre-existing test/implementation mismatches.","dependencies":[{"issue_id":"pfn_mcp-eb4","depends_on_id":"pfn_mcp-1p8","type":"blocks","created_at":"2026-01-06T15:03:10.328718+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-f58","title":"Create generate_tools_reference.py script","description":"Parse tools.yaml and generate docs/tools-reference.md. Include defer_loading recommendations. Plan: ~/.claude/plans/concurrent-finding-anchor.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T12:44:16.453018+07:00","updated_at":"2026-01-15T13:02:38.238046+07:00","closed_at":"2026-01-15T13:02:38.238046+07:00","close_reason":"Created scripts/generate_tools_reference.py and generated docs/tools-reference.md"}
{"id":"pfn_mcp-fb7","title":"Add nearest-value sampling for instantaneous quantities","description":"For instantaneous quantities (voltage, power, current), pick value at bucket START instead of AVG. Use DISTINCT ON with ORDER BY bucket ASC. File: src/pfn_mcp/tools/group_telemetry.py","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T17:49:34.009819+07:00","updated_at":"2026-01-07T18:02:35.091282+07:00","closed_at":"2026-01-07T18:02:35.091282+07:00","close_reason":"Added is_instantaneous_quantity() helper, _query_nearest_value_timeseries() and _query_avg_value_timeseries() functions. 11 new tests added (46 total passing).","dependencies":[{"issue_id":"pfn_mcp-fb7","depends_on_id":"pfn_mcp-b83","type":"blocks","created_at":"2026-01-07T17:49:45.648813+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-fof","title":"Smart data source selection for telemetry queries","description":"Use telemetry_data (raw 5-sec) for queries \u003c=4h, telemetry_15min_agg for longer queries. See: docs/playground/time_format_update.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-07T11:16:00.72147+07:00","updated_at":"2026-01-07T11:31:58.830347+07:00","closed_at":"2026-01-07T11:31:58.830347+07:00","close_reason":"Implemented smart data source selection (raw 5-sec for \u003c=4h, raw aggregated for 4-24h)"}
{"id":"pfn_mcp-g4j","title":"Implement compare_electricity_periods tool","description":"Compare electricity costs between two time periods.\n\n**Reference:** docs/electricity_cost_tools.md\n\n**Parameters:**\n- device or tenant: Entity to compare (at least one required)\n- period1: First period (e.g., 2025-11)\n- period2: Second period (e.g., 2025-12)\n\n**Response includes:**\n- Consumption and cost for each period\n- Absolute and percentage change\n- Supports month-over-month and custom range comparisons\n\n**Implementation notes:**\n- Parse period strings to date ranges\n- Run two aggregation queries\n- Calculate change metrics","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T08:58:54.276957+07:00","updated_at":"2025-12-27T10:32:36.742678+07:00","closed_at":"2025-12-27T10:32:36.742678+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-g4j","depends_on_id":"pfn_mcp-d71","type":"blocks","created_at":"2025-12-27T08:59:03.405469+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-gax","title":"Create energy_consumption.py module","description":"Implement get_energy_consumption() and format function. Smart data source selection, device-specific quantity detection (124 vs 131), inline cost calculation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T16:13:06.256497+07:00","updated_at":"2026-01-07T16:21:43.319606+07:00","closed_at":"2026-01-07T16:21:43.319606+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-grd","title":"Consolidate device resolver in resolve.py","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T14:06:30.533445+07:00","updated_at":"2026-01-14T14:28:14.435206+07:00","closed_at":"2026-01-14T14:28:14.435206+07:00","close_reason":"Implemented tenant filtering for 8 tools, created resolve_device(), and documented in docs/tools-review.md"}
{"id":"pfn_mcp-i6n","title":"Implement get_energy_consumption tool","description":"New tool to return actual energy consumption (not cumulative readings). Smart data source: daily_energy_cost_summary for daily+, telemetry_intervals_cumulative for sub-daily. Reference: docs/energy_consumption_update.md","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-07T16:12:54.960418+07:00","updated_at":"2026-01-07T16:25:38.2243+07:00","closed_at":"2026-01-07T16:25:38.2243+07:00","close_reason":"Implemented get_energy_consumption tool with smart data source selection","dependencies":[{"issue_id":"pfn_mcp-i6n","depends_on_id":"pfn_mcp-gax","type":"blocks","created_at":"2026-01-07T16:13:17.343103+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-i6n","depends_on_id":"pfn_mcp-qjt","type":"blocks","created_at":"2026-01-07T16:13:17.630897+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-i6n","depends_on_id":"pfn_mcp-8ui","type":"blocks","created_at":"2026-01-07T16:13:17.958336+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-ij7","title":"Fix list_tags response structure","description":"list_tags() returns dict without expected keys (tags, data, keys). Test: test_list_available_tags. Need to verify response structure matches expected format.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T10:18:19.736686+07:00","updated_at":"2026-01-06T11:01:47.163592+07:00","closed_at":"2026-01-06T11:01:47.163592+07:00","close_reason":"Fixed test assertion to match actual list_tags response structure (tags_by_category, categories, total_tags)"}
{"id":"pfn_mcp-ilx","title":"Setup Next.js project with shadcn/ui","description":"Initialize Next.js 14 with TypeScript, Tailwind, and shadcn/ui. See plan: .claude/plans/twinkly-waddling-thompson.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:51:47.732199+07:00","updated_at":"2026-01-12T16:11:12.899392+07:00","closed_at":"2026-01-12T16:11:12.899392+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-ilx","depends_on_id":"pfn_mcp-mmg","type":"blocks","created_at":"2026-01-12T15:52:36.03731+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-iw3","title":"Engineering review: quantity term mappings","description":"Review docs/engineering-terms.md and confirm/modify quantity term mappings. Questions to answer: THD default, voltage unbalance default, water temperature default. See plan: .claude/plans/eager-yawning-marshmallow.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T09:43:21.503159+07:00","updated_at":"2026-01-10T09:52:27.320399+07:00","closed_at":"2026-01-10T09:52:27.320399+07:00","close_reason":"Engineering review complete. THD→1119, voltage unbalance→1117, water temp→3923 (supply)"}
{"id":"pfn_mcp-j8e","title":"Prototype: LiteLLM per-team budget enforcement","description":"Test LiteLLM with Open WebUI: 1) Create teams matching tenants, 2) Set budget limits, 3) Verify X-OpenWebUI-User-Id header mapping, 4) Confirm requests are rejected when budget exceeded. REQUIRES prototyping.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T13:55:22.116001+07:00","updated_at":"2026-01-06T11:28:48.385203+07:00","closed_at":"2026-01-06T11:28:48.385203+07:00","close_reason":"Prototype complete: verified team creation, budget limits, and enforcement. Budget exceeded requests are rejected. See prototype/litellm_budget/"}
{"id":"pfn_mcp-kqt","title":"Step 7: Docker and deployment","description":"Docker configuration for frontend and backend. Nginx reverse proxy setup. Environment configuration for production VPS.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T13:22:43.820253+07:00","updated_at":"2026-01-04T13:22:43.820253+07:00","dependencies":[{"issue_id":"pfn_mcp-kqt","depends_on_id":"pfn_mcp-mmg","type":"blocks","created_at":"2026-01-04T13:22:53.626457+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-ktd","title":"Implement list_devices tool","description":"MCP tool to browse devices with fuzzy search on display_name. Return device info with tenant context. Handle prefix conflicts (MC-1 vs MC-10).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T10:31:39.856706+07:00","updated_at":"2025-12-25T11:19:39.248357+07:00","closed_at":"2025-12-25T11:19:39.248357+07:00","close_reason":"Implemented with fuzzy search, match ranking (exact \u003e prefix \u003e contains), tenant filter, and formatted output","dependencies":[{"issue_id":"pfn_mcp-ktd","depends_on_id":"pfn_mcp-tmd","type":"blocks","created_at":"2025-12-25T10:32:03.363747+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-l5z","title":"Phase 2: Telemetry Tools Extension","description":"Complete Phase 2 from concept.md: (1) Peak Analysis Tool - find peaks with timestamps, (2) Extend Group Telemetry - support all WAGE quantities. Note: get_cost_summary already covered by existing get_electricity_cost tools. Plan: .claude/plans/happy-scribbling-pebble.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T16:20:51.145546+07:00","updated_at":"2026-01-06T08:52:42.431579+07:00","closed_at":"2026-01-06T08:52:42.431579+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-l9j","title":"Test approval workflow end-to-end","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:22:15.518416+07:00","updated_at":"2026-01-07T17:49:12.15561+07:00","closed_at":"2026-01-07T17:49:12.15561+07:00","close_reason":"Approval workflow tested and working. Key fix: role check must be INSIDE forms subflow (after Username Password Form), not as top-level execution. Flow 'Simple Browser with Approval' is bound to openwebui client. Users with approved-user role (via group) can login; users without are denied with access_denied error.","dependencies":[{"issue_id":"pfn_mcp-l9j","depends_on_id":"pfn_mcp-46y","type":"blocks","created_at":"2026-01-07T11:22:23.158257+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-l9j","depends_on_id":"pfn_mcp-d7d","type":"blocks","created_at":"2026-01-07T11:22:23.473912+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-l9j","depends_on_id":"pfn_mcp-62u","type":"blocks","created_at":"2026-01-07T11:22:23.785834+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-lhh","title":"Export Chat to TXT","description":"Add Export as TXT option (normal + debug mode) to conversation three-dot menu. Normal mode excludes tool calls, debug mode includes them for tools team workflow.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T07:47:54.296308+07:00","updated_at":"2026-01-15T07:56:18.165455+07:00","closed_at":"2026-01-15T07:56:18.165455+07:00","close_reason":"Export as TXT feature implemented with normal and debug modes. Normal mode strips tool messages and \u003cthink\u003e blocks."}
{"id":"pfn_mcp-mmg","title":"Step 6: React/Next.js frontend","description":"Next.js frontend with: Keycloak OAuth login, chat interface with SSE streaming, conversation sidebar, tenant selector (superuser), per-tenant branding. Capacitor-ready for mobile.\n\nImplementation plan: .claude/plans/twinkly-waddling-thompson.md\n\nSubtasks: ilx, 4hp, y9m, 51z, 3rh, wqw","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T13:22:43.355857+07:00","updated_at":"2026-01-12T16:17:49.832119+07:00","closed_at":"2026-01-12T16:17:49.832119+07:00","close_reason":"Frontend implementation complete: Next.js 14 + TypeScript + Tailwind + shadcn/ui. All features implemented: OAuth login, chat with SSE streaming, conversation sidebar, tenant selector, usage meter.","dependencies":[{"issue_id":"pfn_mcp-mmg","depends_on_id":"pfn_mcp-46a","type":"blocks","created_at":"2026-01-04T13:22:53.347876+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-nft","title":"Implement find_devices_by_quantity tool","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T19:43:07.945151+07:00","updated_at":"2025-12-25T20:00:23.955899+07:00","closed_at":"2025-12-25T20:00:23.955899+07:00","close_reason":"All 5 Phase 1 discovery tools implemented and tested"}
{"id":"pfn_mcp-nnx","title":"Add search_tags function to group_telemetry.py","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:52:51.281211+07:00","updated_at":"2026-01-07T16:55:41.959294+07:00","closed_at":"2026-01-07T16:55:41.959294+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-nta","title":"Setup: Keycloak groups for tenants","description":"Create Keycloak groups matching tenants (PRS, IOP, etc.). Configure group claims in tokens. Document group → tenant_id mapping.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T14:18:45.436404+07:00","updated_at":"2026-01-07T10:36:53.524322+07:00","closed_at":"2026-01-07T10:36:53.524322+07:00","close_reason":"Created 4 tenant groups (IOP, PME_SITE_1, PME_SITE_2, PRS) with tenant_id attributes. Group membership mapper configured for openwebui client. Documentation added to prototype/README.md.","dependencies":[{"issue_id":"pfn_mcp-nta","depends_on_id":"pfn_mcp-9ew","type":"blocks","created_at":"2026-01-04T14:18:57.367985+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-nyp","title":"Fix GROUP BY error in get_electricity_cost_ranking query","description":"get_electricity_cost_ranking fails with:\nasyncpg.exceptions.GroupingError: column 'decs.total_cost' must appear in GROUP BY clause or be used in aggregate function\n\nAffected tests (3 failures):\n- test_rank_devices_by_cost\n- test_highest_energy_consumer\n- test_comprehensive_tenant_report (uses ranking)\n\nFix: Update the SQL query to properly aggregate or group the columns.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T11:23:57.880664+07:00","updated_at":"2026-01-06T14:04:45.957657+07:00","closed_at":"2026-01-06T14:04:45.957657+07:00","close_reason":"Fixed GROUP BY error by changing ORDER BY to use aggregated column aliases (cost_rp/consumption_kwh) instead of raw column names (total_cost/total_consumption)"}
{"id":"pfn_mcp-ovm","title":"Connect MCP server to Open WebUI via SSE","description":"Integrate PFN MCP tools with Open WebUI using SSE transport.\n\nARCHITECTURE:\nOpen WebUI → mcpo (OpenAPI proxy) → MCP SSE Server → Valkyrie DB\n\nOpen WebUI doesn't support SSE natively - requires mcpo proxy to convert\nMCP SSE to OpenAPI format.\n\nDEPLOYMENT STEPS:\n1. Create Dockerfile for pfn-mcp SSE server\n2. Add pfn-mcp service to docker-compose (connects to host PostgreSQL)\n3. Add mcpo service as proxy (connects to pfn-mcp SSE)\n4. Configure Open WebUI to use mcpo as Tool Server\n5. Test tool discovery and execution\n\nNETWORK:\n- pfn-mcp needs access to host PostgreSQL (port 5432)\n- mcpo connects to pfn-mcp SSE endpoint\n- Open WebUI connects to mcpo OpenAPI endpoint\n\nRELATED FILES:\n- src/pfn_mcp/sse_server.py - SSE/HTTP transport for MCP\n- prototype/docker-compose.yml - Deployment config","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T06:35:58.555522+07:00","updated_at":"2026-01-08T07:55:54.558183+07:00","closed_at":"2026-01-08T07:55:54.558183+07:00","close_reason":"MCP tools integrated with Open WebUI via mcpo proxy. SSE server (systemd) → mcpo (Docker) → Open WebUI. All 25 tools available. Tenant filtering working.","dependencies":[{"issue_id":"pfn_mcp-ovm","depends_on_id":"pfn_mcp-d0m","type":"blocks","created_at":"2026-01-08T06:36:05.611713+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-pzn","title":"Switch LLM to Claude Sonnet","description":"Change default model from MiniMax to Claude Sonnet 4 in .env and config. MiniMax has server-side tool_call_id bugs that cause inconsistent replies.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T11:17:25.832961+07:00","updated_at":"2026-01-14T11:29:52.691812+07:00","closed_at":"2026-01-14T11:29:52.691812+07:00","close_reason":"Updated .env to use claude-sonnet-4-20250514. Added ANTHROPIC_API_KEY placeholder."}
{"id":"pfn_mcp-qjt","title":"Add get_energy_consumption to tools.yaml and server.py","description":"Add tool schema to tools.yaml and handler in server.py call_tool function.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T16:13:06.709664+07:00","updated_at":"2026-01-07T16:21:43.325109+07:00","closed_at":"2026-01-07T16:21:43.325109+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-qjt","depends_on_id":"pfn_mcp-gax","type":"blocks","created_at":"2026-01-07T16:13:16.964641+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-qkd","title":"Implement get_device_info tool","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T19:43:10.951022+07:00","updated_at":"2025-12-25T20:00:23.957315+07:00","closed_at":"2025-12-25T20:00:23.957315+07:00","close_reason":"All 5 Phase 1 discovery tools implemented and tested"}
{"id":"pfn_mcp-rc5","title":"Register Phase 2 tools in server.py","description":"Add get_peak_analysis tool registration and call handler. Update get_group_telemetry schema with quantity parameters.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T16:21:04.415182+07:00","updated_at":"2026-01-06T08:52:38.471866+07:00","closed_at":"2026-01-06T08:52:38.471866+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-rc5","depends_on_id":"pfn_mcp-3tr","type":"blocks","created_at":"2026-01-05T16:21:15.21749+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-rc5","depends_on_id":"pfn_mcp-86y","type":"blocks","created_at":"2026-01-05T16:21:15.502038+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-sdb","title":"UI Refinement: Claude.ai Design Benchmark","description":"Refine PFN Chat UI to match claude.ai's clean, minimal design aesthetic. Warm cream/beige palette, generous whitespace, simplified message bubbles, cleaner input/sidebar. Plan: /Users/octavianusbramantya/.claude/plans/delegated-juggling-sunset.md","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-14T15:29:50.890142+07:00","updated_at":"2026-01-14T15:29:50.890142+07:00"}
{"id":"pfn_mcp-t4a","title":"Add daily_rate and daily_shift group_by options","description":"Add new groupings to get_electricity_cost: daily_rate (per-day × rate) and daily_shift (per-day × shift). This enables comparing rate distribution across different days.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T10:04:26.693042+07:00","updated_at":"2026-01-10T10:33:47.018931+07:00","closed_at":"2026-01-10T10:33:47.018931+07:00","close_reason":"Completed - consolidated electricity cost tools with extended group_by options"}
{"id":"pfn_mcp-tft","title":"Populate quantities-mapping.md from database","description":"Query production database to fill TBD entries in docs/quantities-mapping.md. Verify all quantity IDs match production.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T10:31:40.765084+07:00","updated_at":"2025-12-25T11:12:17.734581+07:00","closed_at":"2025-12-25T11:12:17.734581+07:00","close_reason":"Updated with 77 quantities from production database, organized by category with semantic aliases reference"}
{"id":"pfn_mcp-tmd","title":"Create database connection layer","description":"Implement PostgreSQL connection pooling with asyncpg, read-only access, query timeout limits, and connection string from env vars","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T10:31:39.007641+07:00","updated_at":"2025-12-25T11:04:19.003516+07:00","closed_at":"2025-12-25T11:04:19.003516+07:00","close_reason":"Database layer with asyncpg pool, query helpers, timeouts, and proper cleanup in finally block","dependencies":[{"issue_id":"pfn_mcp-tmd","depends_on_id":"pfn_mcp-bwx","type":"blocks","created_at":"2025-12-25T10:32:02.501775+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-twt","title":"Update tool implementations with tenant filtering","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T14:06:30.94585+07:00","updated_at":"2026-01-14T14:28:14.442027+07:00","closed_at":"2026-01-14T14:28:14.442027+07:00","close_reason":"Implemented tenant filtering for 8 tools, created resolve_device(), and documented in docs/tools-review.md","dependencies":[{"issue_id":"pfn_mcp-twt","depends_on_id":"pfn_mcp-tz2","type":"blocks","created_at":"2026-01-14T14:06:39.638368+07:00","created_by":"daemon"},{"issue_id":"pfn_mcp-twt","depends_on_id":"pfn_mcp-grd","type":"blocks","created_at":"2026-01-14T14:06:39.952004+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-tz2","title":"Add tenant param to 8 tools (schema + server)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T14:06:30.096003+07:00","updated_at":"2026-01-14T14:12:53.730756+07:00","closed_at":"2026-01-14T14:12:53.730756+07:00","close_reason":"Closed"}
{"id":"pfn_mcp-uff","title":"Fix get_group_telemetry output param","description":"server.py handler missing output param passthrough. Plan: ~/.claude/plans/concurrent-finding-anchor.md","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-15T12:44:16.852206+07:00","updated_at":"2026-01-15T13:10:57.0244+07:00","closed_at":"2026-01-15T13:10:57.0244+07:00","close_reason":"Added output parameter to get_group_telemetry handler in server.py:397"}
{"id":"pfn_mcp-vs1","title":"Add quantity mapping to Open WebUI system prompt","description":"Part 3 of plan. Add domain knowledge table to model system prompt in Open WebUI Admin. See: .claude/plans/eager-yawning-marshmallow.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T09:43:30.892877+07:00","updated_at":"2026-01-10T11:33:03.440145+07:00","closed_at":"2026-01-10T11:33:03.440145+07:00","close_reason":"Added system prompt to Open WebUI and documented in docs/openwebui-system-prompt.md","dependencies":[{"issue_id":"pfn_mcp-vs1","depends_on_id":"pfn_mcp-iw3","type":"blocks","created_at":"2026-01-10T09:43:43.696696+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-w2z","title":"Optional: Keycloak email OTP for new devices","description":"Install keycloak-2fa-email-authenticator extension. Configure conditional authentication flow. Test: existing device = no OTP, new device = email OTP. Lower priority - can be added later.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T14:18:46.734336+07:00","updated_at":"2026-01-04T14:18:46.734336+07:00","dependencies":[{"issue_id":"pfn_mcp-w2z","depends_on_id":"pfn_mcp-9ew","type":"blocks","created_at":"2026-01-04T14:18:58.261381+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-wqw","title":"Add branding and usage meter","description":"Per-tenant branding from /api/auth/me. UsageMeter showing budget percentage from /api/usage. See plan: .claude/plans/twinkly-waddling-thompson.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:51:56.607381+07:00","updated_at":"2026-01-12T16:17:43.843416+07:00","closed_at":"2026-01-12T16:17:43.843416+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-wqw","depends_on_id":"pfn_mcp-3rh","type":"blocks","created_at":"2026-01-12T15:52:38.203734+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-xcm","title":"get_quantity_stats tool - pre-flight validation","description":"Quick stats about data availability before expensive telemetry query.\n\n## Purpose\n- Validate data exists for requested period\n- Understand typical value ranges\n- Check for data gaps\n\n## Parameters\n- device_id: int\n- quantity_id/quantity_search: metric selection\n- period: str = '30d'\n\n## Response\n- data_points count\n- min/max/avg values\n- first/last reading timestamps\n- gap count (missing readings)\n\n## When to Use\n- Before get_device_telemetry for validation\n- To set context for anomaly detection\n- User asks 'is there data for X?'\n\n## See also\ndocs/phase2-telemetry.md for full spec","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T20:22:14.626065+07:00","updated_at":"2025-12-27T08:37:31.132048+07:00","closed_at":"2025-12-27T08:37:31.132048+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-xcm","depends_on_id":"pfn_mcp-40b","type":"blocks","created_at":"2025-12-25T20:22:22.973479+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-xpm","title":"UI: Chat Input Refinement","description":"Inline send button inside textarea border, remove button row below, move New Chat to sidebar/header. Parent epic: pfn_mcp-sdb","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T15:30:07.805695+07:00","updated_at":"2026-01-14T16:17:33.17653+07:00","closed_at":"2026-01-14T16:17:33.17653+07:00","close_reason":"Chat input refined: inline send button, New Chat moved to sidebar header, cleaner styling","dependencies":[{"issue_id":"pfn_mcp-xpm","depends_on_id":"pfn_mcp-3xh","type":"blocks","created_at":"2026-01-14T15:30:33.211813+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-y9m","title":"Build chat interface with SSE streaming","description":"ChatMessages + ChatInput + SSE event parser. Handle content, tool_call, tool_result, done events. See plan: .claude/plans/twinkly-waddling-thompson.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:51:48.806095+07:00","updated_at":"2026-01-12T16:16:05.437341+07:00","closed_at":"2026-01-12T16:16:05.437341+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-y9m","depends_on_id":"pfn_mcp-4hp","type":"blocks","created_at":"2026-01-12T15:52:36.856602+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-ye0","title":"Implement get_electricity_cost_ranking tool","description":"Rank devices by consumption or cost within a tenant.\n\n**Reference:** docs/electricity_cost_tools.md\n\n**Parameters:**\n- tenant: Tenant name (required)\n- period: Time period (default: 30d)\n- metric: cost (default), consumption\n- limit: Number of results (default: 10)\n\n**Response includes:**\n- Ranked list of devices\n- Consumption and cost per device\n- Percentage of tenant total\n\n**Implementation notes:**\n- Aggregate by device_id within tenant\n- ORDER BY metric DESC\n- Calculate percentage_of_total from tenant sum","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T08:58:53.752695+07:00","updated_at":"2025-12-27T10:29:28.369617+07:00","closed_at":"2025-12-27T10:29:28.369617+07:00","close_reason":"Closed","dependencies":[{"issue_id":"pfn_mcp-ye0","depends_on_id":"pfn_mcp-d71","type":"blocks","created_at":"2025-12-27T08:59:03.123482+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-z0h","title":"UI: Message Bubble Redesign","description":"Remove card styling from AI messages (no bg/border/shadow). Simplify user bubble to pill shape. Smaller avatars (24px). Parent epic: pfn_mcp-sdb","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T15:30:07.284829+07:00","updated_at":"2026-01-14T16:10:39.439796+07:00","closed_at":"2026-01-14T16:10:39.439796+07:00","close_reason":"Message bubbles redesigned: AI messages without bubble, user messages as pill shape, smaller avatars, subtle tool cards","dependencies":[{"issue_id":"pfn_mcp-z0h","depends_on_id":"pfn_mcp-3xh","type":"blocks","created_at":"2026-01-14T15:30:32.663782+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-z7w","title":"Custom UI: Tool registry implementation","description":"Create tool_registry.py that maps all 38 tool names to (function, formatter) tuples. Load schemas from tools.yaml and generate Claude-compatible tool definitions.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:14:13.890528+07:00","updated_at":"2026-01-12T14:35:49.787216+07:00","closed_at":"2026-01-12T14:35:49.787216+07:00","close_reason":"Already implemented in pfn_mcp-6aw (tool_registry.py with 23 tools mapped)","dependencies":[{"issue_id":"pfn_mcp-z7w","depends_on_id":"pfn_mcp-6aw","type":"blocks","created_at":"2026-01-10T12:14:21.499035+07:00","created_by":"daemon"}]}
{"id":"pfn_mcp-zjh","title":"Add SSE/HTTP transport for remote deployment","description":"Convert stdio transport to SSE/HTTP for production VPS deployment","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T14:57:37.474645+07:00","updated_at":"2025-12-25T15:03:03.355389+07:00","closed_at":"2025-12-25T15:03:03.355389+07:00","close_reason":"SSE/HTTP transport with Starlette, health endpoint, systemd service, and deployment scripts"}
{"id":"pfn_mcp-zz9","title":"Create sys-prompt-ver-3-structured.md","description":"Cache-optimized prompt with clear breakpoints. Plan: ~/.claude/plans/concurrent-finding-anchor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T12:44:18.24358+07:00","updated_at":"2026-01-15T13:16:48.19606+07:00","closed_at":"2026-01-15T13:16:48.19606+07:00","close_reason":"Created sys-prompt-ver-3-structured.md with cache breakpoints","dependencies":[{"issue_id":"pfn_mcp-zz9","depends_on_id":"pfn_mcp-f58","type":"blocks","created_at":"2026-01-15T12:44:25.595975+07:00","created_by":"daemon"}]}
